@model IK_Intranet_App.Models.Gorev
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager

@{
    // Yetki Hesaplamaları (Her kart için ayrı ayrı yapılır)
    var currentUserId = UserManager.GetUserId(User);
    var isAdmin = User.IsInRole("Admin");
    var isOlusturan = Model.OlusturanUserId == currentUserId;
    var isAtanan = Model.AppUserId == currentUserId;
}

<div class="card mb-3 shadow-sm border-0 hover-card" style="border-radius: 10px;" data-task-id="@Model.Id">
    <div class="card-body">
        <h5 class="card-title fw-bold text-dark">@Model.Baslik</h5>
        <p class="card-text text-muted small">@Model.Aciklama</p>
        <hr class="my-2 opacity-25">

        <div class="d-flex justify-content-between align-items-center">
            @if (Model.AppUser != null)
            {
                <span class="badge rounded-pill bg-light text-dark border">
                    <i class="bi bi-person-fill me-1"></i> @Model.AppUser.AdSoyad
                </span>
            }
            else
            {
                <span class="badge rounded-pill bg-danger">Atanmamış</span>
            }

            <small class="text-muted" style="font-size: 0.75rem;">
                @Model.OlusturmaTarihi.ToString("dd.MM HH:mm")
            </small>
        </div>

        <div class="mt-3 d-flex justify-content-end gap-2">
            @if (isAdmin || isOlusturan || isAtanan)
            {
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-sm btn-light text-primary" title="Düzenle">
                    <i class="bi bi-pencil-square"></i>
                </a>
            }
            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-sm btn-light text-info" title="Detay">
                <i class="bi bi-eye-fill"></i>
            </a>
            @if (isAdmin || isOlusturan)
            {
                <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-sm btn-light text-danger" title="Sil">
                    <i class="bi bi-trash-fill"></i>
                </a>
            }
        </div>
    </div>
</div>